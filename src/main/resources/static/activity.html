<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä –ñ—É—Ä–Ω–∞–ª –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ - Football Hub</title>
    <link href="/css/style.css" rel="stylesheet">
    <style>
        .activity-feed {
            background: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        .activity-item {
            padding: 20px 30px;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s ease;
        }
        
        .activity-item:hover {
            background: #f0f9f4;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .activity-icon.matches {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
        }
        
        .activity-icon.forum {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .activity-icon.news {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-action {
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
            font-size: 16px;
        }
        
        .activity-details {
            color: var(--gray);
            font-size: 14px;
        }
        
        .activity-time {
            color: var(--gray);
            font-size: 13px;
            white-space: nowrap;
            font-weight: 600;
        }
        
        .empty-state-custom {
            padding: 80px 30px;
            text-align: center;
            color: var(--gray);
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
<header class="site-header">
    <div class="top-bar">
        <div class="wrap">
            <div class="top-bar-content">
                <div class="site-logo">
                    <span class="logo-icon">‚öΩ</span>
                    <span class="logo-text">FOOTBALL HUB</span>
                </div>
                <nav class="main-nav">
                    <a href="/moderator.html" class="nav-link">–ù–ê–ó–ê–î</a>
                </nav>
                <div id="userInfo" class="user-info">
                    <span class="user-name"><span id="username"></span></span>
                    <button onclick="logout()" class="btn-logout">–í–∏–π—Ç–∏</button>
                </div>
            </div>
        </div>
    </div>
</header>

<div class="hero-section">
    <div class="wrap">
        <h1 class="hero-title">üìä –ñ—É—Ä–Ω–∞–ª –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</h1>
        <p class="hero-subtitle">–û—Å—Ç–∞–Ω–Ω—ñ –ø–æ–¥—ñ—ó –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ñ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ</p>
    </div>
</div>

<main class="site-main">
    <div class="wrap">
        <div class="leagues-tabs" style="margin-bottom: 32px;">
            <button class="league-tab active" onclick="filterActivities('ALL', this)">üåê –í—Å—ñ –ø–æ–¥—ñ—ó</button>
            <button class="league-tab" onclick="filterActivities('MATCHES', this)">‚öΩ –ú–∞—Ç—á—ñ</button>
            <button class="league-tab" onclick="filterActivities('FORUM', this)">üí¨ –§–æ—Ä—É–º</button>
            <button class="league-tab" onclick="filterActivities('NEWS', this)">üì∞ –ù–æ–≤–∏–Ω–∏</button>
        </div>
        
        <div class="activity-feed" id="activityFeed">
            <div class="empty-state-custom">
                <div class="empty-state-icon">‚è≥</div>
                <p style="font-size: 18px; font-weight: 600;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ...</p>
            </div>
        </div>
    </div>
</main>

<script src="/js/auth.js"></script>
<script>
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–ª—ñ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞
    if (!isAuthenticated() || getRole() !== 'MODERATOR') {
        window.location.href = '/login.html';
    }
    
    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–º–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    document.getElementById('username').textContent = getUsername();
    
    let currentFilter = 'ALL';
    
    function getIconForCategory(category) {
        const icons = {
            'MATCHES': '‚öΩ',
            'FORUM': 'üí¨',
            'NEWS': 'üì∞'
        };
        return icons[category] || 'üìå';
    }
    
    function formatTime(timestamp) {
        const date = new Date(timestamp);
        const now = new Date();
        const diff = Math.floor((now - date) / 1000);
        
        if (diff < 60) return '—â–æ–π–Ω–æ';
        if (diff < 3600) return `${Math.floor(diff / 60)} —Ö–≤ —Ç–æ–º—É`;
        if (diff < 86400) return `${Math.floor(diff / 3600)} –≥–æ–¥ —Ç–æ–º—É`;
        return date.toLocaleDateString('uk-UA', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' });
    }
    
    function renderActivities(activities) {
        const feed = document.getElementById('activityFeed');
        
        if (!activities || activities.length === 0) {
            feed.innerHTML = `
                <div class="empty-state-custom">
                    <div class="empty-state-icon">üì≠</div>
                    <p style="font-size: 18px; font-weight: 600; color: var(--gray);">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</p>
                    <p style="margin-top: 8px; color: var(--gray);">–°—Ç–≤–æ—Ä—ñ—Ç—å –º–∞—Ç—á –∞–±–æ —Ç–µ–º—É –Ω–∞ —Ñ–æ—Ä—É–º—ñ, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –ø–æ–¥—ñ—ó —Ç—É—Ç</p>
                </div>
            `;
            return;
        }
        
        feed.innerHTML = activities.map(activity => `
            <div class="activity-item">
                <div class="activity-icon ${activity.category.toLowerCase()}">
                    ${getIconForCategory(activity.category)}
                </div>
                <div class="activity-content">
                    <div class="activity-action">${activity.action}</div>
                    <div class="activity-details">${activity.details}</div>
                </div>
                <div class="activity-time">${formatTime(activity.timestamp)}</div>
            </div>
        `).join('');
    }
    
    async function loadActivities() {
        try {
            const url = currentFilter === 'ALL' 
                ? '/api/activity?limit=50'
                : `/api/activity/category/${currentFilter}?limit=50`;
                
            const response = await fetchWithAuth(url);
            const activities = await response.json();
            renderActivities(activities);
        } catch (error) {
            console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ:', error);
            document.getElementById('activityFeed').innerHTML = `
                <div class="empty-state-custom">
                    <div class="empty-state-icon">‚ö†Ô∏è</div>
                    <p style="font-size: 18px; font-weight: 600; color: var(--danger);">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</p>
                    <p style="margin-top: 8px; color: var(--gray);">${error.message}</p>
                </div>
            `;
        }
    }
    
    function filterActivities(category, element) {
        currentFilter = category;
        
        document.querySelectorAll('.league-tab').forEach(btn => {
            btn.classList.remove('active');
        });
        element.classList.add('active');
        
        loadActivities();
    }
    
    loadActivities();
    setInterval(loadActivities, 5000);
</script>
</body>
</html>

